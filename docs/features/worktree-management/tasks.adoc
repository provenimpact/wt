= Implementation Tasks: Worktree Management
:version: 3.0.0
:status: Implemented
:source-design-version: 2.1.0
:source-stories-version: 1.2.0
:source-spec-version: 1.2.0
:last-updated: 2026-02-27
:feature: worktree-management
:toc:

== Overview

Implements main worktree visibility across all worktree listings and the interactive selector (issue #9). 2 phases, 5 tasks. Phase 1 modifies the TUI entry model and selector rendering. Phase 2 updates the command layer across 4 files.

== Phase 1: TUI Model Update

Add `IsMain` field to the TUI entry struct and update the selector to render main worktree entries with a distinct visual style.

* [x] TASK-020: Add `IsMain` field to `tui.Entry` and update selector rendering [sequential]
+
Components:: `internal/tui/selector.go`
Stories:: US-001, US-013
Specs:: WT-052
Description:: Add `IsMain bool` field to the `Entry` struct. In the `View()` method, when rendering an entry where `IsMain` is true, apply a dimmed foreground style (using the existing `dimStyle` or a new `mainStyle` lipgloss style) to both the branch name and the path text. The main entry remains fully selectable -- the distinct style is for visual identification only. When the entry is the selected entry (`i == m.selected`), combine the selected cursor styling with the dimmed indicator so it is still clear the main entry is highlighted.

== Phase 2: Command Layer Updates

Update commands to include the main worktree in their output and remove the main-worktree filter.

* [x] TASK-021: Include main worktree in interactive selector (`cmd/root.go`) [parallel]
+
Components:: `cmd/root.go`
Stories:: US-001, US-013
Specs:: WT-001, WT-004, WT-053
Description:: Remove the `if wt.Path == info.MainWorktree { continue }` filter in `runSelector`. Include the main worktree in the `entries` slice with `IsMain: true`. Change the "no worktrees" condition to check for zero linked worktrees (i.e., when the only worktree is main, still show the "No worktrees found" message since the user needs to create linked worktrees to use the selector meaningfully).

* [x] TASK-022: Include main worktree in switch error hint and completions [parallel]
+
Components:: `cmd/switch.go`, `cmd/completions.go`
Stories:: US-005, US-011, US-013
Specs:: WT-021, WT-044, WT-054, WT-055
Description:: In `cmd/switch.go` `runSwitch()`, remove the `if wt.Path == info.MainWorktree { continue }` filter in the "not found" error hint so the main worktree branch is listed among available worktrees. In `cmd/completions.go`, update `completeWorktreeBranches()` to include all worktree branch names (including main). Keep `completeLinkedWorktreeBranches()` filtering out the main worktree (it is used by `wt remove`).

* [x] TASK-023: Update `wt list` to always show table when worktrees exist [parallel]
+
Components:: `cmd/list.go`
Stories:: US-004, US-013
Specs:: WT-018, WT-019
Description:: The current `wt list` already includes the main worktree in the table when linked worktrees exist. However, when only the main worktree exists, it returns early with "No additional worktrees" before rendering any table. Keep this early-return behavior (the design specifies this message when no linked worktrees exist). No code change is needed here if the existing behavior matches the updated spec. Verify and confirm.

* [x] TASK-024: Update tests for main worktree inclusion [parallel]
+
Components:: `cmd/cmd_test.go`, `internal/tui/selector_test.go`
Stories:: US-001, US-004, US-005, US-011, US-013
Specs:: WT-001, WT-021, WT-044, WT-052, WT-053, WT-054, WT-055
Description:: Update `TestRoot_NoWorktreesMessage` to verify the "no worktrees" message still appears when only the main worktree exists. Add a new test `TestRoot_IncludesMainWorktree` verifying that when linked worktrees exist, the selector entries include the main worktree. Update `TestList_WithWorktrees` to verify the main worktree appears in the list output. Add a new test for `tui.Entry.IsMain` rendering in selector. Update `TestSwitch_NotFound` or equivalent to verify the error hint includes the main worktree. Update completion tests to verify `completeWorktreeBranches()` includes the main branch and `completeLinkedWorktreeBranches()` excludes it.

== Traceability

[cols="1,2,2", options="header"]
|===
| Story | Spec IDs | Tasks

| US-001: Interactive Worktree Selection
| WT-001, WT-052, WT-053
| TASK-020, TASK-021

| US-004: List Worktrees
| WT-018, WT-019
| TASK-023

| US-005: Switch to Worktree
| WT-021, WT-054
| TASK-022

| US-011: Shell Completion
| WT-044, WT-055
| TASK-022

| US-013: Main Worktree Visibility
| WT-001, WT-018, WT-021, WT-044, WT-052, WT-053, WT-054, WT-055
| TASK-020, TASK-021, TASK-022, TASK-023, TASK-024
|===
